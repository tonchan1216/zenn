---
title: "CLSの改善方法について"
emoji: "😭"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["パフォーマンス","performance","webvitals"]
published: false
---

※本記事は[web.dev](https://web.dev/optimize-cls/)を学習用にまとめたものです。解釈に齟齬等あればコメントください。

# Overview
Googleで提唱されているWebページのパフォーマンス指標である **CLS (Cumulative Layout Shift)** を最適化する具体的な手法について記載する。

CLSとは何かについては、[Web Vitalsとは何か](https://zenn.dev/articles/9dceffeeb207eb/)を参照してください。


# CLSが悪化する５つの原因

## 1. サイズ指定がされてない動画像

レスポンシブ対応されたサイトでは、横幅が計算値を指定するケースがある。

これにより、「画像を読み込むまでサイズが決定できない」という状況が発生する。

```css
img {
  width: 100%; /* or max-width: 100%; */
  height: auto;
}
```

従って、画像のダウンロードが終わった瞬間にガクッとレイアウトシフトが起きてしまう。

## 2. サイズ指定がされてない広告やiframe

広告用スクリプトが読み込まれ、広告コンテンツをDOMに挿入するタイミングでレイアウトシフトが発生する。

また、埋め込みコンテンツやiframeに関しても、事前にサイズを確保できていないとレイアウトシフトが発生してしまう。

## 3. 動的なコンテンツの挿入

ユーザの操作とは関係のないタイミングで、コンテンツが挿入されたときにレイアウトシフトが発生する。

たとえば、以下のような内容のバナー表示。

- サインインしてください
- 関連のあるコンテンツはこちら
- iOS/Androidアプリをインストールしてください


## 4. Web FontsによるFOIT/FOUT

Webフォントをダウンロードしてレンダリングすると、次の2つの方法でレイアウトがシフトする。

- FOUT: フォールバックフォントが読み込んだフォントと切り替わる
- FOIT: フォントを読み込まれるまで非表示テキストが**表示**される

## 5. アニメーション

CSSプロパティを変化させるようなアニメーションの多用によって、レイアウトシフトは発生する。

例えば、`box-shadow`や`box-sizing`を変化させると、再描画を引き起こす。

<!-- # どうすれば改善する?? -->
